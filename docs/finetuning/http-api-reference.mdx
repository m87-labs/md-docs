---
sidebar_position: 3
title: "HTTP API reference"
---

# HTTP API reference

Base URL: `https://api.moondream.ai/v1/tuning/`

## Authentication

All requests require the `X-Moondream-Auth` header with your API key:

```
X-Moondream-Auth: YOUR_API_KEY
```

Get your API key from the [Moondream Cloud Console](https://moondream.ai/c/cloud/api-keys).

---

## POST /adapters

Create a new adapter for finetuning.

### Request

```json
{
  "name": "my-adapter",
  "rank": 32
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| name | string | yes | Unique name for this adapter (alphanumeric, hyphens, underscores) |
| rank | integer | yes | LoRA rank: 8, 16, 24, or 32 (must be multiple of 8; higher = more capacity, but slower) |

### Response

```json
{
  "adapter_id": "01HXYZ..."
}
```

| Field | Type | Description |
|-------|------|-------------|
| adapter_id | string | Unique identifier (ULID) for the adapter. Use this ID for all subsequent operations. |

If an adapter with the same name already exists with the same rank, the existing `adapter_id` is returned (idempotent). If the name exists with a different rank, returns 409 Conflict.

---

## GET /adapters

List all adapters for your organization.

### Query parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | integer | 50 | Maximum results per page (1–100) |
| cursor | string | — | Pagination cursor from previous response |

### Response

```json
{
  "adapters": [
    {
      "adapter_id": "01HXYZ...",
      "name": "my-adapter",
      "rank": 32,
      "created_at": "2025-01-15T10:30:00Z"
    }
  ],
  "next_cursor": "eyJjIjoiMjAyNS0wMS0xNVQxMDozMDowMFoifQ==",
  "has_more": true
}
```

Results are ordered by creation time (oldest first).

---

## GET /adapters/:adapterId

Get details for a specific adapter.

### Response

```json
{
  "adapter_id": "01HXYZ...",
  "name": "my-adapter",
  "rank": 32,
  "created_at": "2025-01-15T10:30:00Z"
}
```

Returns 404 if the adapter does not exist.

---

## DELETE /adapters/:adapterId

Delete an adapter. This is a soft delete—the adapter is marked as deleted and its checkpoints are cleaned up asynchronously.

### Response

Returns 204 No Content on success.

**Constraints:**
- Returns 409 Conflict if the adapter has any releases. You must delete releases before deleting the adapter.
- Returns 404 if the adapter does not exist.

---

## POST /rollouts

Generate rollouts for a training or evaluation request.

### Request

```json
{
  "adapter_id": "01HXYZ...",
  "num_rollouts": 4,
  "request": { ... },
  "ground_truth": { ... }  // optional
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| adapter_id | string | yes | The adapter ID (from POST /adapters response) |
| num_rollouts | integer | yes | Number of attempts to generate (1–16) |
| request | object | yes | Skill-specific request (see below) |
| ground_truth | object | no | Ground truth for automatic reward computation (point/detect only) |

### Skill requests

**Query**

```json
{
  "skill": "query",
  "question": "What color is the car?",
  "image_url": "data:image/jpeg;base64,...",  // optional
  "reasoning": false,  // optional
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 128
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"query"` |
| question | string | yes | The question to answer |
| image_url | string | no | Base64 data URL of the image |
| reasoning | boolean | no | Enable extended reasoning (default: false) |
| settings | object | no | Generation settings |

**Point**

```json
{
  "skill": "point",
  "object": "the red button",
  "image_url": "data:image/jpeg;base64,...",
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 128
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"point"` |
| object | string | yes | Description of the object to point to |
| image_url | string | yes | Base64 data URL of the image |
| settings | object | no | Generation settings |

**Detect**

```json
{
  "skill": "detect",
  "object": "vehicles",
  "image_url": "data:image/jpeg;base64,...",
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 256,
    "max_objects": 8
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"detect"` |
| object | string | yes | Description of objects to detect |
| image_url | string | yes | Base64 data URL of the image |
| settings | object | no | Generation settings (includes `max_objects`) |

### Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| temperature | number | 1.0 | Controls randomness (0 = deterministic) |
| top_p | number | 1.0 | Nucleus sampling threshold |
| max_tokens | integer | 128 | Maximum output length |
| max_objects | integer | — | Maximum objects to detect (detect only) |

### Ground truth

**Point** — coordinates:

```json
{
  "points": [{ "x": 0.52, "y": 0.31 }]
}
```

**Point** — bounding boxes (rewards based on containment):

```json
{
  "boxes": [{ "x_min": 0.1, "y_min": 0.2, "x_max": 0.4, "y_max": 0.6 }]
}
```

**Detect**:

```json
{
  "boxes": [
    { "x_min": 0.1, "y_min": 0.2, "x_max": 0.4, "y_max": 0.6 }
  ]
}
```

All coordinates are normalized to 0–1.

### Response

```json
{
  "request": { ... },
  "rollouts": [
    {
      "skill": "detect",
      "output": {
        "objects": [
          { "x_min": 0.12, "y_min": 0.22, "x_max": 0.39, "y_max": 0.58 }
        ]
      },
      // ... opaque training metadata
    }
  ],
  "rewards": [0.8, 0.3, 0.6, 0.5]
}
```

| Field | Type | Description |
|-------|------|-------------|
| request | object | Echoed request |
| rollouts | array | Generated rollouts |
| rewards | array \| null | Computed rewards if ground truth was provided |

### Rollout output by skill

**Query**:

```json
{
  "answer": "The car is red.",
  "reasoning": null  // present if reasoning was enabled
}
```

**Point**:

```json
{
  "points": [{ "x": 0.52, "y": 0.31 }]
}
```

**Detect**:

```json
{
  "objects": [
    { "x_min": 0.12, "y_min": 0.22, "x_max": 0.39, "y_max": 0.58 }
  ]
}
```

---

## POST /train_step

Apply one training step using scored rollouts.

### Request

```json
{
  "adapter_id": "01HXYZ...",
  "groups": [
    {
      "request": { ... },
      "rollouts": [ ... ],
      "rewards": [0.8, 0.3, 0.6, 0.5]
    }
  ],
  "lr": 0.002
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| adapter_id | string | yes | The adapter ID to train |
| groups | array | yes | List of training groups |
| lr | number | no | Learning rate (default: 0.002) |

Each group:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| request | object | yes | The echoed request from /rollouts response |
| rollouts | array | yes | The rollout objects from /rollouts response (pass unchanged) |
| rewards | array | yes | Reward for each rollout (same length and order) |

You can mix skills across groups in the same train step.

### Response

```json
{}
```

---

## GET /adapters/:adapterId/checkpoints

List checkpoints for an adapter. Checkpoints are created automatically when training steps are applied.

### Query parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | integer | 50 | Maximum results per page (1–100) |
| cursor | string | — | Pagination cursor from previous response |

### Response

```json
{
  "checkpoints": [
    {
      "step": 100,
      "expires_at": "2025-01-16T10:30:00Z",
      "released": false,
      "created_at": "2025-01-15T10:30:00Z"
    },
    {
      "step": 200,
      "expires_at": null,
      "released": true,
      "released_at": "2025-01-15T12:00:00Z",
      "created_at": "2025-01-15T11:30:00Z"
    }
  ],
  "next_cursor": "eyJzIjo1MDB9",
  "has_more": true
}
```

| Field | Type | Description |
|-------|------|-------------|
| step | integer | Training step number |
| expires_at | string \| null | When this checkpoint expires, or `null` if pinned/released |
| released | boolean | Whether this checkpoint has been promoted to a release |
| released_at | string | When the release was created (only present if released) |
| created_at | string | When the checkpoint was created |

Results are ordered by step (ascending).

**Checkpoint states:**
- **Active**: Has not expired yet, or is pinned (`expires_at` is `null`)
- **Expiring soon**: `expires_at` is approaching
- **Expired**: Past `expires_at` (will be cleaned up soon unless it's the latest checkpoint)

---

## PATCH /adapters/:adapterId/checkpoints/:step

Modify a checkpoint's expiration. Use this to pin (save), extend, shorten, or delete checkpoints.

### Request

```json
{
  "expires_at": "2025-01-20T00:00:00Z"
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| expires_at | string \| null | yes | ISO 8601 timestamp, or `null` to pin (never expire) |

**Operations:**
- **Pin (save)**: Set `expires_at` to `null` — checkpoint never expires
- **Extend**: Set `expires_at` further in the future
- **Shorten**: Set `expires_at` closer (but still in the future)
- **Delete**: Set `expires_at` to a past timestamp — checkpoint becomes eligible for cleanup

### Response

Returns 204 No Content on success.

**Constraints:**
- Cannot modify a checkpoint that has already been cleaned up (returns 410 Gone)
- Cannot modify an expired checkpoint, except for the latest checkpoint per adapter
- Cannot set a finite expiration on the latest checkpoint (returns 409 Conflict) — the latest checkpoint is always protected for training resumability
- Cannot modify a released checkpoint (returns 409 Conflict)

---

## POST /adapters/:adapterId/checkpoints/:step/release

Promote a checkpoint to a release. Releases are persistent artifacts optimized for inference.

When you release a checkpoint:
1. The checkpoint is pinned (set to never expire)
2. The LoRA weights are extracted and converted to an optimized format
3. The release becomes available for inference

### Response

Returns 200 OK on success (empty body).

**Constraints:**
- Returns 404 if the checkpoint does not exist
- Returns 410 Gone if the checkpoint was already cleaned up or expired (except for the latest checkpoint)
- If already released, returns 200 OK (idempotent)

---

## GET /releases

List all releases for your organization.

### Query parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | integer | 50 | Maximum results per page (1–100) |
| cursor | string | — | Pagination cursor from previous response |

### Response

```json
{
  "releases": [
    {
      "adapter_id": "01HXYZ...",
      "adapter_name": "my-detector",
      "step": 5000
    }
  ],
  "next_cursor": "eyJyIjoxNzA1MzEyMjA1MDAwfQ==",
  "has_more": true
}
```

| Field | Type | Description |
|-------|------|-------------|
| adapter_id | string | The adapter ID |
| adapter_name | string | The adapter name |
| step | integer | The training step that was released |

Results are ordered by release time (newest first).
