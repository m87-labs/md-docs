---
sidebar_position: 3
title: "HTTP API reference"
---

# HTTP API reference

Base URL: `https://api.moondream.ai/v1/tuning/`

## Authentication

All requests require the `X-Moondream-Auth` header with your API key:

```
X-Moondream-Auth: YOUR_API_KEY
```

Get your API key from the [Moondream Cloud Console](https://moondream.ai/c/cloud/api-keys).

---

## POST /adapters

Create a new adapter for finetuning.

### Request

```json
{
  "adapter": "my-adapter",
  "rank": 32
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| adapter | string | yes | Unique identifier for this adapter (alphanumeric, hyphens, underscores) |
| rank | integer | yes | LoRA rank: 8, 16, 24, or 32 (must be multiple of 8; higher = more capacity, but slower) |

### Response

```json
{
  "adapter": "my-adapter",
  "rank": 32,
  "created": true
}
```

| Field | Type | Description |
|-------|------|-------------|
| adapter | string | The adapter identifier |
| rank | integer | The LoRA rank |
| created | boolean | `true` if newly created, `false` if adapter already existed |

---

## POST /rollouts

Generate rollouts for a training or evaluation request.

### Request

```json
{
  "adapter": "abc123",
  "num_rollouts": 4,
  "request": { ... },
  "ground_truth": { ... }  // optional
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| adapter | string | yes | The adapter to use |
| num_rollouts | integer | yes | Number of attempts to generate (1–16) |
| request | object | yes | Skill-specific request (see below) |
| ground_truth | object | no | Ground truth for automatic reward computation (point/detect only) |

### Skill requests

**Query**

```json
{
  "skill": "query",
  "question": "What color is the car?",
  "image_url": "data:image/jpeg;base64,...",  // optional
  "reasoning": false,  // optional
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 128
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"query"` |
| question | string | yes | The question to answer |
| image_url | string | no | Base64 data URL of the image |
| reasoning | boolean | no | Enable extended reasoning (default: false) |
| settings | object | no | Generation settings |

**Point**

```json
{
  "skill": "point",
  "object": "the red button",
  "image_url": "data:image/jpeg;base64,...",
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 128
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"point"` |
| object | string | yes | Description of the object to point to |
| image_url | string | yes | Base64 data URL of the image |
| settings | object | no | Generation settings |

**Detect**

```json
{
  "skill": "detect",
  "object": "vehicles",
  "image_url": "data:image/jpeg;base64,...",
  "settings": {
    "temperature": 1.0,
    "top_p": 1.0,
    "max_tokens": 256,
    "max_objects": 8
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| skill | string | yes | Must be `"detect"` |
| object | string | yes | Description of objects to detect |
| image_url | string | yes | Base64 data URL of the image |
| settings | object | no | Generation settings (includes `max_objects`) |

### Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| temperature | number | 1.0 | Controls randomness (0 = deterministic) |
| top_p | number | 1.0 | Nucleus sampling threshold |
| max_tokens | integer | 128 | Maximum output length |
| max_objects | integer | — | Maximum objects to detect (detect only) |

### Ground truth

**Point** — coordinates:

```json
{
  "points": [{ "x": 0.52, "y": 0.31 }]
}
```

**Point** — bounding boxes (rewards based on containment):

```json
{
  "boxes": [{ "x_min": 0.1, "y_min": 0.2, "x_max": 0.4, "y_max": 0.6 }]
}
```

**Detect**:

```json
{
  "boxes": [
    { "x_min": 0.1, "y_min": 0.2, "x_max": 0.4, "y_max": 0.6 }
  ]
}
```

All coordinates are normalized to 0–1.

### Response

```json
{
  "request": { ... },
  "rollouts": [
    {
      "skill": "detect",
      "output": {
        "objects": [
          { "x_min": 0.12, "y_min": 0.22, "x_max": 0.39, "y_max": 0.58 }
        ]
      },
      // ... opaque training metadata
    }
  ],
  "rewards": [0.8, 0.3, 0.6, 0.5]
}
```

| Field | Type | Description |
|-------|------|-------------|
| request | object | Echoed request |
| rollouts | array | Generated rollouts |
| rewards | array \| null | Computed rewards if ground truth was provided |

### Rollout output by skill

**Query**:

```json
{
  "answer": "The car is red.",
  "reasoning": null  // present if reasoning was enabled
}
```

**Point**:

```json
{
  "points": [{ "x": 0.52, "y": 0.31 }]
}
```

**Detect**:

```json
{
  "objects": [
    { "x_min": 0.12, "y_min": 0.22, "x_max": 0.39, "y_max": 0.58 }
  ]
}
```

---

## POST /train_step

Apply one training step using scored rollouts.

### Request

```json
{
  "adapter": "my-adapter",
  "groups": [
    {
      "request": { ... },
      "rollouts": [ ... ],
      "rewards": [0.8, 0.3, 0.6, 0.5]
    }
  ],
  "lr": 0.002
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| adapter | string | yes | The adapter to train |
| groups | array | yes | List of training groups |
| lr | number | no | Learning rate (default: 0.002) |

Each group:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| request | object | yes | The echoed request from /rollouts response |
| rollouts | array | yes | The rollout objects from /rollouts response (pass unchanged) |
| rewards | array | yes | Reward for each rollout (same length and order) |

You can mix skills across groups in the same train step.

### Response

```json
{}
```
